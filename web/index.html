<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拯救Hzr</title>
    <!-- 可选：设置 API_BASE（留空则同源），如：https://your-domain.example -->
    <meta name="hzr-api-base" content="">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./vendor/katex/katex.min.css">
    <link rel="stylesheet" href="./style.css">
    <script src="./vendor/purify.min.js" defer></script>
    <script src="./vendor/markdown-it.min.js" defer></script>
    <script src="./vendor/katex/katex.min.js" defer></script>
    <script src="./vendor/katex/auto-render.min.js" defer></script>

    <!-- App (split into small modules; keep each file <= 500 lines) -->
    <script src="./src/app-internal/01-compat.js" defer></script>
    <script src="./src/app-internal/04-utils.js" defer></script>
    <script src="./src/app-internal/02-data.js" defer></script>
    <script src="./src/app-internal/03-dom.js" defer></script>
    <script src="./src/app-internal/05-modal-scroll-lock.js" defer></script>
    <script src="./src/app-internal/06-local-storage.js" defer></script>
    <script src="./src/app-internal/07-cloud-sync.js" defer></script>
    <script src="./src/app-internal/08-chapter-interop.js" defer></script>
    <script src="./src/app-internal/09-chapter-find.js" defer></script>
    <script src="./src/app-internal/25-favorites.js" defer></script>
    <script src="./src/app-internal/27-study-progress.js" defer></script>
    <script src="./src/app-internal/26-search.js" defer></script>
    <script src="./src/app-internal/10-sidebar-home.js" defer></script>
    <script src="./src/app-internal/11-book-ui.js" defer></script>
    <script src="./src/app-internal/12-chapter-view.js" defer></script>
    <script src="./src/app-internal/13-ai-chat.js" defer></script>
    <script src="./src/app-internal/14-ai-import-ui.js" defer></script>
    <script src="./src/app-internal/15-ai-import-runtime.js" defer></script>
    <script src="./src/app-internal/16-ai-history.js" defer></script>
    <script src="./src/app-internal/17-ai-selection.js" defer></script>
    <script src="./src/app-internal/18-chapter-delete.js" defer></script>
    <script src="./src/app-internal/19-drag-core.js" defer></script>
    <script src="./src/app-internal/20-drag-runtime.js" defer></script>
    <script src="./src/app-internal/21-json-import.js" defer></script>
    <script src="./src/app-internal/24-exam-state.js" defer></script>
    <script src="./src/app-internal/24-exam-picker.js" defer></script>
    <script src="./src/app-internal/24-exam-runner.js" defer></script>
    <script src="./src/app-internal/22-bind-ui-layout.js" defer></script>
    <script src="./src/app-internal/22-bind-ui-books.js" defer></script>
    <script src="./src/app-internal/22-bind-ui-import.js" defer></script>
    <script src="./src/app-internal/22-bind-ui-settings.js" defer></script>
    <script src="./src/app-internal/22-bind-ui-sync.js" defer></script>
    <script src="./src/app-internal/22-bind-ui-ai.js" defer></script>
    <script src="./src/app-internal/22-bind-ui-exam.js" defer></script>
    <script src="./src/app-internal/22-bind-ui-entry.js" defer></script>
    <script src="./src/app-internal/23-startup.js" defer></script>
</head>
<body>

    <div class="app-container">
        <aside class="sidebar" id="sidebar">
	            <div class="brand">
	                <div class="brand-left">
	                    <i class="fa-solid fa-flask-vial"></i>
	                    <span class="brand-text">
	                        <span class="brand-text-full">拯救Hzr</span>
	                        <span class="brand-text-short">Hzr</span>
	                    </span>
	                </div>
	                <div class="brand-actions">
	                    <button id="sidebarSearchBtn" class="collapse-btn" type="button" title="搜索">
	                        <i class="fa-solid fa-magnifying-glass"></i>
	                    </button>
                    <button id="sidebarExamBtn" class="collapse-btn" type="button" title="考试">
                        <i class="fa-solid fa-graduation-cap"></i>
                    </button>
                    <button id="sidebarHomeTopBtn" class="collapse-btn" type="button" title="主页">
                        <i class="fa-solid fa-book"></i>
                    </button>
                    <button id="sidebarCollapseBtn" class="collapse-btn" type="button" title="折叠侧边栏">
                        <i class="fa-solid fa-angles-left"></i>
                    </button>
                </div>
            </div>
            
            <!-- 章节列表容器 -->
            <div class="chapter-list" id="chapterList">
                <!-- JS将在这里渲染文件夹和章节 -->
            </div>

            <!-- 底部功能区 -->
            <div class="sidebar-footer">
                <!-- 新建文件夹 -->
                <button id="addFolderBtn" class="action-btn icon-btn" title="新建文件夹">
                    <i class="fa-solid fa-folder-plus"></i>
                </button>

                <!-- 导入（文件/粘贴合并） -->
                <button id="importBtn" class="action-btn icon-btn" title="导入（文件/粘贴）">
                    <i class="fa-solid fa-file-import"></i>
                </button>

                <!-- 同步/账号 -->
                <button id="syncBtn" class="action-btn icon-btn" title="同步/账号">
                    <i class="fa-solid fa-cloud"></i>
                </button>

                <!-- 设置 -->
                <button id="settingsBtn" class="action-btn icon-btn" title="设置">
                    <i class="fa-solid fa-gear"></i>
                </button>
            </div>
        </aside>

        <div class="sidebar-overlay" id="sidebarOverlay" aria-hidden="true"></div>

        <main class="main-content">
            <header class="top-bar">
                <button id="menuToggle" class="menu-toggle"><i class="fa-solid fa-bars"></i></button>
                <button id="homeBtn" class="menu-toggle" title="主页"><i class="fa-solid fa-book"></i></button>
                <h2 id="currentChapterTitle">请选择章节</h2>
                <div id="syncStatus" class="sync-status" style="margin-left:auto;">
                    <span class="status-dot status-dot--off" aria-hidden="true"></span>
                    <span class="sync-label"></span>
                </div>
                <button id="aiHistoryBtn" class="action-btn icon-btn" type="button" title="AI 历史/新对话">
                    <i class="fa-solid fa-robot"></i>
                </button>
                <button id="aiImportBtn" class="action-btn icon-btn" type="button" title="AI 拍照导入">
                    <i class="fa-solid fa-camera"></i>
                </button>
            </header>
            
	            <div id="homeView" class="home-view">
	                <div class="home-bg" aria-hidden="true"></div>
	                <div class="home-scroll">
	                    <div class="home-hud" aria-label="主页工具栏">
	                        <div class="home-hud-brand">
	                            <div class="home-hud-title">
	                                <span class="home-hud-title-full">拯救Hzr</span>
	                                <span class="home-hud-title-phone">Hzr得到！</span>
	                            </div>
	                            <div class="home-hud-subtitle">Hzr想要，Hzr得到！</div>
	                        </div>
	                        <div class="home-hud-actions" aria-label="主页操作">
	                            <button id="homeSyncBtn" class="modal-btn" type="button" title="云同步"><i class="fa-solid fa-cloud"></i><span class="btn-text">云同步</span></button>
	                            <button id="homeSettingsBtn" class="modal-btn" type="button" title="设置"><i class="fa-solid fa-gear"></i><span class="btn-text">设置</span></button>
                            <button id="homeAiBtn" class="modal-btn" type="button" title="AI"><i class="fa-solid fa-robot"></i><span class="btn-text">AI</span></button>
                            <span class="home-hud-divider" aria-hidden="true"></span>
                            <button id="importBookBtn" class="modal-btn" type="button"><i class="fa-solid fa-file-import"></i><span class="btn-text">导入书</span></button>
                            <button id="newBookBtn" class="modal-btn primary" type="button"><i class="fa-solid fa-plus"></i><span class="btn-text">新建书</span></button>
                        </div>
                    </div>

                    <section class="home-library" aria-label="书库">
                        <div class="home-library-head">
                            <div class="home-library-title">我的书</div>
                            <div class="home-library-hint">点击打开 · 长按/右键编辑</div>
                        </div>
                        <div id="booksGrid" class="library-grid" aria-label="书库"></div>
                    </section>
                </div>
            </div>

            <div class="questions-container" id="questionsContainer">
                <div class="welcome-message">
                    <h3>欢迎复习</h3>
                    <p>您可以：</p>
                    <ul style="margin-left:20px; color:#666;">
                        <li>点击“新建文件夹”整理题库</li>
                        <li>将章节<b>拖拽</b>到文件夹中（移动端可按住右侧<b>拖拽</b>按钮）</li>
                        <li><b>双击</b>名称进行重命名</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <button id="toTopBtn" class="to-top-btn" type="button" title="回到顶部" aria-label="回到顶部">
        <i class="fa-solid fa-arrow-up"></i>
    </button>

    <button id="fabMenu" class="fab-menu" type="button" aria-label="菜单">
        <i class="fa-solid fa-bars"></i>
    </button>

    <div class="toast-host" id="toastHost" aria-live="polite" aria-atomic="true"></div>

    <div class="modal-overlay" id="searchModal" aria-hidden="true">
        <div class="modal-box search-box" role="dialog" aria-modal="true" aria-label="全局搜索">
            <div class="modal-sticky-close">
                <button class="icon-btn modal-close-x" type="button" title="关闭" aria-label="关闭">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="search-sticky">
                <div class="search-head">
                    <div class="search-title">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <span>全局搜索</span>
                    </div>
                    <div id="searchStatus" class="search-status"></div>
                </div>
                <div class="search-bar">
                    <input id="searchInput" class="auth-input search-input" placeholder="搜索：题干 / 选项 / 解析 / 知识点（当前书内）" autocomplete="off" />
                </div>
            </div>
            <div id="searchResults" class="search-results" role="list"></div>
        </div>
    </div>

    <div class="modal-overlay" id="examModal" aria-hidden="true">
        <div class="exam-box" role="dialog" aria-modal="true" aria-label="考试模式">
            <div class="exam-header">
                <div class="exam-header-left">
                    <i class="fa-solid fa-graduation-cap"></i>
                    <div class="exam-header-titles">
                        <div id="examHeaderTitle" class="exam-header-title">考试</div>
                        <div id="examHeaderSub" class="exam-header-sub"></div>
                    </div>
                </div>
                <div class="exam-header-actions">
                    <div id="examHeaderTimer" class="exam-timer" aria-label="计时器">00:00</div>
                    <button id="examRestartBtn" class="action-btn icon-btn" type="button" title="重新开始" aria-label="重新开始">
                        <i class="fa-solid fa-rotate-right"></i>
                    </button>
                    <button id="examExitBtn" class="action-btn icon-btn" type="button" title="退出" aria-label="退出">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>

            <div class="exam-body">
                <div id="examPickerView" class="exam-pane"></div>
                <div id="examRunnerView" class="exam-pane" style="display:none;"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="examExitModal" aria-hidden="true">
        <div class="modal-box" role="dialog" aria-modal="true" aria-label="退出考试">
            <h3 style="margin-top:0;">退出考试</h3>
            <div id="examExitHint" style="color:#667085; font-size:0.95rem; line-height:1.5; margin:10px 0 12px;"></div>
            <div class="modal-actions" style="display:flex; gap:10px; flex-wrap:wrap;">
                <button id="examExitCancelBtn" class="modal-btn" type="button">继续做题</button>
                <button id="examExitKeepBtn" class="modal-btn primary" type="button">保留进度并退出</button>
                <button id="examExitDiscardBtn" class="modal-btn danger" type="button">不保留退出</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="importModal">
        <div class="modal-box">
            <div class="modal-sticky-close">
                <button class="icon-btn modal-close-x" type="button" title="关闭" aria-label="关闭">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <h3>导入题库</h3>
            <div class="seg-tabs" style="margin:12px 0 8px;">
                <button id="importTabFile" class="seg-tab active" type="button">文件</button>
                <button id="importTabPaste" class="seg-tab" type="button">粘贴</button>
            </div>

            <div id="importPaneFile">
                <div style="display:flex; gap:10px; align-items:center; margin:10px 0;">
                    <input type="file" id="importFileInput" accept=".json">
                </div>
                <div style="color:#667085; font-size:0.92rem;">支持 JSON：单章节/多章节/文件夹树/完整结构。</div>
            </div>

            <div id="importPanePaste" style="display:none;">
                <textarea id="importTextarea" placeholder='{"title": "...", "questions": [...]}'></textarea>
                <div class="modal-actions">
                    <button id="cancelImportBtn" class="modal-btn">取消</button>
                    <button id="confirmImportBtn" class="modal-btn primary">导入</button>
                </div>
            </div>

            <div class="modal-actions" style="margin-top:14px;">
                <button id="closeImportBtn" class="modal-btn">关闭</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="folderModal">
        <div class="modal-box">
            <div class="modal-sticky-close">
                <button class="icon-btn modal-close-x" type="button" title="关闭" aria-label="关闭">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <h3>新建文件夹</h3>
            <div style="display:grid; gap:10px; margin-top:10px;">
                <input id="folderNameInput" class="auth-input" placeholder="文件夹名称">
            </div>
            <div class="modal-actions" style="margin-top:14px;">
                <button id="folderCancelBtn" class="modal-btn">取消</button>
                <button id="folderCreateBtn" class="modal-btn primary">创建</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="bookModal">
        <div class="modal-box">
            <div class="modal-sticky-close">
                <button class="icon-btn modal-close-x" type="button" title="关闭" aria-label="关闭">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <h3>新建书</h3>
            <div style="display:grid; gap:10px; margin-top:12px;">
                <input id="bookNameInput" class="auth-input" placeholder="书名（例如：药理学）">
                <div style="color:#667085; font-size:0.92rem;">新建后进入空白书，可用“导入”导入 JSON 构建题库。</div>

                <div style="margin-top:6px;">
                    <div style="font-weight:700; color:#334155; margin-bottom:8px;">颜色</div>
                    <div id="bookThemeChoices" class="choice-grid" aria-label="书本颜色"></div>
                </div>

                <div style="margin-top:2px;">
                    <div style="font-weight:700; color:#334155; margin-bottom:8px;">图标</div>
                    <div id="bookIconChoices" class="choice-grid choice-grid--icons" aria-label="书本图标"></div>
                </div>
            </div>
            <div class="modal-actions" style="margin-top:14px;">
                <button id="bookCancelBtn" class="modal-btn">取消</button>
                <button id="bookCreateBtn" class="modal-btn primary">创建</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="authModal">
        <div class="modal-box">
            <div class="modal-sticky-close">
                <button class="icon-btn modal-close-x" type="button" title="关闭" aria-label="关闭">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <h3 style="display:flex; align-items:center; gap:10px; justify-content:space-between;">
                <span>云同步</span>
                <span id="syncModalStatus" style="font-size:0.9rem; font-weight:600; color:#667085;"></span>
            </h3>

            <div class="seg-tabs" style="margin:12px 0 8px;">
                <button id="syncTabAccount" class="seg-tab active" type="button">账号</button>
                <button id="syncTabSaves" class="seg-tab" type="button">存档</button>
                <button id="authLogoutBtn" class="modal-btn" type="button" style="margin-left:auto; display:none;">退出登录</button>
            </div>

            <div id="syncPaneAccount">
                <div style="display:flex; gap:10px; margin:10px 0;">
                    <button id="authTabLogin" class="modal-btn primary" type="button">登录</button>
                    <button id="authTabRegister" class="modal-btn" type="button">注册</button>
                </div>
                <div style="display:grid; gap:10px;">
                    <input id="authUsername" class="auth-input" placeholder="用户名（3-32位，字母数字._-）">
                    <input id="authPassword" class="auth-input" placeholder="密码（>=8位）" type="password">
                    <div id="authHint" style="color:#667085; font-size:0.9rem;"></div>
                </div>
                <div id="syncEnableRow" style="display:none; margin-top:12px; padding:10px 12px; border:1px solid rgba(197,74,90,0.22); background:rgba(197,74,90,0.06); border-radius:12px;">
                    <div style="font-weight:700; color:#7b2c36;">云同步未启用</div>
                    <div style="margin-top:6px; color:#667085; font-size:0.92rem;">云端为空或同步未完成初始化时，为避免误覆盖，系统不会自动上传本机。</div>
                    <div class="modal-actions" style="margin-top:10px; justify-content:flex-start;">
                        <button id="enableSyncUploadBtn" class="modal-btn primary" type="button">上传本机到云端（启用同步）</button>
                    </div>
                    <div id="enableSyncHint" style="margin-top:6px; color:#667085; font-size:0.9rem;"></div>
                </div>
                <div class="modal-actions" style="margin-top:14px;">
                    <button id="authCancelBtn" class="modal-btn">关闭</button>
                    <button id="authSubmitBtn" class="modal-btn primary">提交</button>
                </div>
            </div>

            <div id="syncPaneSaves" style="display:none;">
                <div style="display:flex; gap:10px; align-items:center; margin:10px 0;">
                    <input id="archiveName" class="auth-input" placeholder="存档名（可选）">
                    <button id="createArchiveBtn" class="modal-btn primary" type="button">新建存档</button>
                    <button id="refreshSavesBtn" class="modal-btn" type="button">刷新</button>
                </div>

                <div class="save-section">
                    <div class="save-title">手动存档</div>
                    <div id="archivesList" class="save-list"></div>
                </div>

                <div class="save-section" style="margin-top:14px;">
                    <div class="save-title">自动存档（每 5 分钟）</div>
                    <div id="revisionsList" class="save-list"></div>
                </div>

                <div id="savesHint" style="margin-top:10px; color:#667085; font-size:0.9rem;"></div>
                <div class="modal-actions" style="margin-top:14px;">
                    <button id="savesCloseBtn" class="modal-btn">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal-box">
            <div class="modal-sticky-close">
                <button class="icon-btn modal-close-x" type="button" title="关闭" aria-label="关闭">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <h3>设置</h3>

            <div class="settings-section" style="margin-top:10px;">
                <div class="settings-title">外观（可自定义）</div>

                <div class="settings-row">
                    <div class="settings-label">解析色</div>
                    <div class="settings-control">
                        <input id="uiAnalysisColor" type="color">
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">知识点色</div>
                    <div class="settings-control">
                        <input id="uiKnowledgeColor" type="color">
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">强调（加粗）色</div>
                    <div class="settings-control">
                        <input id="uiEmphasisColor" type="color">
                    </div>
                </div>

                <div class="settings-row" style="align-items:flex-start;">
                    <div class="settings-label">高亮色盘（多选）</div>
                    <div class="settings-control">
                        <div id="uiHighlightPalette" class="swatch-grid"></div>
                        <div class="settings-inline">
                            <label>强度
                                <select id="uiHighlightIntensity">
                                    <option value="0.38">淡</option>
                                    <option value="0.55" selected>中</option>
                                    <option value="0.72">深</option>
                                </select>
                            </label>
                            <label>随机
                                <select id="uiHighlightMode">
                                    <option value="stable" selected>同题稳定</option>
                                    <option value="random">每次随机</option>
                                </select>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="settings-inline" style="margin-top:10px;">
                    <button id="resetUiBtn" class="modal-btn" type="button">恢复默认配色</button>
                </div>

                <div class="settings-preview">
                    <div class="analysis-box">
                        <div class="analysis-title"><i class="fa-solid fa-lightbulb"></i> 解析</div>
                        <div class="analysis-content">示例：<span class="highlight">高亮</span> 与 <span class="bold-em">强调</span>。</div>
                    </div>
                    <details class="knowledge-details" open>
                        <summary class="knowledge-summary"><i class="fa-solid fa-book-medical"></i> 知识点：示例</summary>
                        <div class="knowledge-content">示例：<span class="highlight">随机高亮</span>、<span class="bold-em">关键词</span>。</div>
                    </details>
                </div>
            </div>

            <div class="modal-actions" style="margin-top:14px; justify-content:space-between;">
                <button id="settingsCloseBtn" class="modal-btn" type="button">关闭</button>
                <button id="exportLocalBtn" class="modal-btn" type="button">导出全部备份（JSON）</button>
            </div>

            <div id="settingsDangerZone" class="danger-zone" style="margin-top:14px;">
                <div class="danger-title">危险操作</div>
                <div class="danger-desc">重置会清空本地导入/自建内容，并恢复预设题库。</div>
                <div class="modal-actions" style="justify-content:flex-end; margin-top:10px;">
                    <button id="resetToDefaultBtn" class="modal-btn danger" type="button">重置到默认</button>
                </div>
                <div id="resetHint" style="margin-top:10px; color:#667085; font-size:0.9rem;"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="aiChatModal">
        <div class="modal-box ai-chat-box">
            <div class="ai-chat-header">
                <div class="ai-chat-title" id="aiChatTitle">AI 对话</div>
                <div class="ai-chat-actions">
                    <button id="aiChatHistoryBtn" class="action-btn icon-btn" type="button" title="AI 历史">
                        <i class="fa-solid fa-clock-rotate-left"></i>
                    </button>
                    <div id="aiChatModelSwitch" class="ai-model-switch" role="radiogroup" aria-label="模型选择">
                        <button type="button" class="ai-model-option active" data-value="flash" aria-checked="true" role="radio">Flash</button>
                        <button type="button" class="ai-model-option" data-value="pro" aria-checked="false" role="radio">Pro</button>
                    </div>
                    <button id="aiChatCloseBtn" class="action-btn icon-btn ai-chat-close" type="button" title="关闭">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>

            <details class="ai-chat-context" id="aiChatContextWrap">
                <summary>题目信息（上下文）</summary>
                <div id="aiChatContextText" class="ai-chat-context-text"></div>
            </details>

            <div class="ai-chat-messages" id="aiChatMessages" aria-live="polite"></div>

            <div class="ai-chat-input">
                <div class="ai-chat-hint" id="aiChatHint"></div>
                <div id="aiChatQuote" class="ai-chat-quote" style="display:none;">
                    <div class="ai-chat-quote-badge" aria-hidden="true">&gt;</div>
                    <div id="aiChatQuoteText" class="ai-chat-quote-text"></div>
                    <button id="aiChatQuoteClearBtn" class="ai-chat-quote-clear" type="button" title="移除引用">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="ai-chat-input-row">
                    <textarea id="aiChatInput" placeholder="输入你的问题…" rows="2"></textarea>
                    <button id="aiChatSendBtn" class="modal-btn primary" type="button">发送</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="aiImportModal">
        <div class="modal-box ai-import-box">
            <div class="ai-import-header">
                <div class="ai-import-title">AI 拍照导入</div>
                <button id="aiImportCloseBtn" class="action-btn icon-btn" type="button" title="关闭">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div class="ai-import-row">
                <div class="ai-import-label">图片（最多 9 张）</div>
                <input id="aiImportFilesInput" type="file" accept="image/*" multiple>
                <div class="ai-import-sub">支持拖拽到窗口内；电脑端支持 Ctrl+V 粘贴截图。</div>
                <div id="aiImportFilesList" class="ai-import-files"></div>
            </div>

            <div class="ai-import-row">
                <div class="ai-import-label">附加文字（可选）</div>
                <textarea id="aiImportNoteText" placeholder="例如：这几页是第 3 章，重点是……" rows="3"></textarea>
            </div>

            <div class="ai-import-row ai-import-inline">
                <div class="ai-import-label">模型</div>
                <div id="aiImportModelSwitch" class="ai-model-switch ai-model-switch--small" role="radiogroup" aria-label="导入模型">
                    <button type="button" class="ai-model-option active" data-value="flash" aria-checked="true" role="radio">Flash</button>
                    <button type="button" class="ai-model-option" data-value="pro" aria-checked="false" role="radio">Pro</button>
                </div>
                <button id="aiImportStartBtn" class="modal-btn primary" type="button">开始导入</button>
                <button id="aiImportCancelBtn" class="modal-btn danger" type="button" style="display:none;">终止任务</button>
            </div>

            <div class="ai-import-row">
                <div class="ai-import-label">进度</div>
                <div class="ai-import-progress">
                    <div class="ai-import-progress-bar"><div id="aiImportProgressFill" class="ai-import-progress-fill"></div></div>
                    <div id="aiImportProgressText" class="ai-import-progress-text">未开始</div>
                </div>
                <div id="aiImportQueueText" class="ai-import-queue"></div>
                <div id="aiImportHint" class="ai-import-hint"></div>
                <div id="aiImportResult" class="ai-import-result"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="aiHistoryModal">
        <div class="modal-box ai-history-box">
            <div class="ai-history-header">
                <div class="ai-history-title">AI 历史</div>
                <div class="ai-history-actions">
                    <select id="aiHistoryScopeSelect" class="ai-history-scope" aria-label="对话范围">
                        <option value="" selected>全部</option>
                        <option value="general">通用</option>
                    </select>
                    <button id="aiHistoryNewBtn" class="modal-btn primary" type="button">新对话</button>
                    <button id="aiHistoryRefreshBtn" class="modal-btn" type="button">刷新</button>
                    <button id="aiHistoryCloseBtn" class="action-btn icon-btn" type="button" title="关闭">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>
            <div id="aiHistoryList" class="ai-history-list"></div>
            <div id="aiHistoryHint" class="ai-history-hint"></div>
        </div>
    </div>

</body>
</html>
